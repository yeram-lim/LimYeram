<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Type Ahead ğŸ‘€</title>
  <link rel="stylesheet" href="6ê°•.css">
</head>
<body>

  <form class="search-form">
    <input type="text" class="search" placeholder="City or State">
    <ul class="suggestions">
      <li>Filter for a city</li>
      <li>or a state</li>
    </ul>
  </form>
<script>
const endpoint = 'https://gist.githubusercontent.com/Miserlou/c5cd8364bf9b2420bb29/raw/2bf258763cdddd704f8ffd3ea9a3e81d25e2c6f6/cities.json';

let cities = [];

fetch(endpoint) //ajax êµ¬í˜„, ì„œë²„ì—ê²Œ endpoint ìš”ì²­í•œë‹¤.
  .then(blob => blob.json()) //thenì€ ì„œë²„ê°€ ì‘ë‹µí•˜ê³  ë‚˜ì„œ ë‹¤ë¥¸ ì¼ì„ ìˆ˜í–‰í•˜ê²Œ ë§Œë“ ë‹¤.
  .then(data => cities.push(...data)) //cities ë¹ˆ ë°°ì—´ì— ìš”ì†Œë¥¼ ë„£ì–´ì¤€ë‹¤. '...'ì„ í•¨ê»˜ ì¨ì•¼ ìš”ì†Œë³„ë¡œ ë¶„ë¦¬í•´ì„œ ë„£ëŠ”ë‹¤. (ì•ˆ ì“°ë©´ ëª¨ë“  ìš”ì†Œê°€ ë°°ì—´í˜•ì‹ìœ¼ë¡œ í•œêº¼ë²ˆì— ë“¤ì–´ê°„ë‹¤.)

function findMatches(wordToMatch, cities) { //wordToMatch: ì‚¬ìš©ìê°€ ì…ë ¥í•œ ê°’ì„ ë°›ì•„ì˜¨ë‹¤. 
  return cities.filter(place => { //filter: íŠ¹ì • ì¡°ê±´ì„ ê°€ì§„ ìš”ì†Œë¥¼ ë¹¼ë‚´ëŠ” ë°˜ë³µë¬¸
    const regex = new RegExp(wordToMatch, 'gi'); 
    //RegExp(ì •ê·œí‘œí˜„ì‹): ë¬¸ìì—´ì—ì„œ íŠ¹ì •í•œ ë¬¸ìì—´ì„ ì°¾ì•„ë‚¸ë‹¤.
    //ì •ê·œí‘œí˜„ì‹ ì˜µì…˜ i: ëŒ€ì†Œë¶„ì êµ¬ë¶„x, g: ê²€ìƒ‰ëœ ëª¨ë“  ê²°ê³¼ë¥¼ ë¦¬í„´í•œë‹¤.
    return place.city.match(regex) || place.state.match(regex) //cityì™€ stateì— regexë¥¼ í¬í•¨í•œ ê²ƒë“¤ì„ ì°¾ì•„ ë¦¬í„´í•œë‹¤.
  });
}

function numberWithCommas(x) { //1000ë‹¨ìœ„ë§ˆë‹¤ ì½¤ë§ˆ ë„£ëŠ”ë‹¤.
  return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ',');
}

function displayMatches() {
  const matchArray = findMatches(this.value, cities); //ì…ë ¥í•œ ê°’ì´ findMatches í•¨ìˆ˜ ì¸ìë¡œ ë“¤ì–´ê°„ë‹¤.
  const html = matchArray.map(place => { //ê±¸ëŸ¬ë‚¸ ê°’ë“¤ì„ ëª¨ì•„ ë°°ì—´ë¡œ ë§Œë“ ë‹¤.
    const regex = new RegExp(this.value, 'gi');
    const cityName = place.city.replace(regex, `<span class="hl">${this.value}</span>`); //ê±¸ëŸ¬ë‚¸ ê¸€ìì— hl í´ë˜ìŠ¤ íš¨ê³¼ë¥¼ ë„£ì–´ ë³€ê²½ëœ ê°’ì„ ë¦¬í„´í•œë‹¤.
    const stateName = place.state.replace(regex, `<span class="hl">${this.value}</span>`);
    return `
      <li>
        <span class = "name">${cityName}, ${stateName}</span>
        <span class = "population">${numberWithCommas(place.population)}</span>
      </li>
    `;
  },).join(''); //ë°°ì—´ ìš”ì†Œë¥¼ ''ë¡œ ë‚˜ëˆ ì¤€ë‹¤.
  suggestions.innerHTML = html;
}

const searchInput = document.querySelector('.search')
const suggestions = document.querySelector('.suggestions')

searchInput.addEventListener('change', displayMatches)
searchInput.addEventListener('keyup', displayMatches) //keyup: íƒ€ì´í•‘ ì¹  ë•Œë§ˆë‹¤ ë¬´ì—‡ì„ ì³¤ëŠ”ì§€ ì €ì¥í•œë‹¤.
</script>
</body>
</html>
